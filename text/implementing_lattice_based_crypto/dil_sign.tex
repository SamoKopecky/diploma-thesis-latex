At the beginning of the Dilithium signing process (simplified illustration in figure \ref{img:dil_sign}) the secret key has to be parsed into variables which it consists off. This is done by unpacking the bytes into useful data. The NTT versions of $s_1$, $s_2$, $t_0$ can be precomputed ahead of time to increase the speed of singing. 
\listing{text/code/dilithium.go}{Vectors generation}{lst:dil_sign_1}{48}{53}
\noindent The message to be signed is hashed together with the hash of the public key $tr$ and used later in the algorithm for generating the vector $y$ and random bytes $c$. As~seen in listing \ref{lst:dil_sign_1} the mentioned vector $y$ is generated from $\rho'$, it is then used to calculate another vector $w$. The \texttt{HighBits} function (see subsection \ref{subsec:dil_bit_man}) are then taken from every coefficient of every polynomial of vector $w$. The $\gamma_2$ is a parameter defined in \ref{tab:dil_sec_levels}.

The high bits of $w$ are hashed together with the message hash to create a 32\,B array of bytes $c$ which is then used to scale vectors $s_1$ as seen in listing \ref{lst:dil_sign_2}. The~scaled vectors is added to the vector $y$ which is the second part of the signature followed by the array of bytes $c$. 
\listing{text/code/dilithium.go}{Signature generation}{lst:dil_sign_2}{60}{61}
The vector $z$ together with $c$ will be used to calculate the high bits of $w$ by the verifier without the knowledge of $y$. For that to be feasible hints have to be created, this process is depicted in listing \ref{lst:dil_sign_3}. The first step is to again scale the vector $t_0$ with $c$ and invert the sign of all coefficients. The vector $w-c*s_2$ was calculated before hand and by by adding the scaled vector $ct_0$ to it is used to create the hints together with the inverted $ct_0$ (see \texttt{MakeHint} function in \ref{subsec:dil_bit_man}). The hits are then a~part of the signature.
\newpage 
\listing{text/code/dilithium.go}{Hint generation}{lst:dil_sign_3}{69}{72}

The variables $z$, $ct_0$ and low bits of $w-cs_2$ ($cs_2$ is $s_2$ scaled by $c$) are also checked whether they reveal any part of the secret variables $s_1$, $s_2$ and $t_0$ by using a norm function. This function is simply returns the biggest absolute value of a polynomial coefficient in the whole vector. The norms of vectors are compared to either $\gamma_1$ or $\gamma_2$. If only one of the check fails the whole signing process is restarted with the only change to an integrable variable $\kappa$ that makes sure the vector $y$ is generated differently then last time. Another check that has to be made is for the number of hints. It can't exceed $\gamma$ defined in \ref{tab:dil_sec_levels}.
\object[0.5]{obr}{pictures/dil_enc.pdf}{Dilithium signature creation}{img:dil_sign}

